<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Messages WhatsApp</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    .message { padding: 0.5em; border-bottom: 1px solid #ddd; }
    .sender { font-weight: bold; }
    .time { color: #888; font-size: 0.9em; }
  </style>
</head>
<body>
  <h1>Derniers messages WhatsApp</h1>
  <div id="messages">Chargement…</div>

  <script>
    async function fetchMessages() {
      try {
        const resp = await fetch('http://localhost:8080/api/messages?limit=10');
        if (!resp.ok) throw new Error('Code HTTP ' + resp.status);
        const data = await resp.json();
        const container = document.getElementById('messages');
        container.innerHTML = '';

        if (data.length === 0) {
          container.textContent = 'Aucun message.';
        } else {
          data.forEach(msg => {
            const div = document.createElement('div');
            div.className = 'message';
            div.innerHTML = `
              <span class="sender">${msg.sender}</span>
              <span class="time">[${new Date(msg.timestamp).toLocaleString()}]</span>
              <div>${msg.content || '<i>⚙️ fichier/media reçu</i>'}</div>
            `;
            container.appendChild(div);
          });
        }
      } catch (err) {
        console.error(err);
        document.getElementById('messages').textContent = 'Erreur : ' + err.message;
      }
    }

    // Charge au démarrage
    fetchMessages();

    // Rafraîchit toutes les 10 secondes
    setInterval(fetchMessages, 10000);
  </script>
</body>
</html>
